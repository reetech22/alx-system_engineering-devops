#!/usr/bin/env bash

# Get listening ports and corresponding PIDs
listening_ports=$(ss -tuln | grep 'LISTEN')

# Print header
echo "PID   Program Name     Port"

# Iterate through each listening port
while read -r line; do
    # Extract local address and port
    local_address=$(echo "$line" | awk '{print $5}')
    port=$(echo "$local_address" | awk -F ':' '{print $NF}')
    # Extract PID/Program name
    pid_program=$(echo "$line" | awk '{print $7}')
    # Extract PID and program name
    pid=$(echo "$pid_program" | cut -d',' -f1)
    program=$(echo "$pid_program" | cut -d',' -f2-)
    # Print PID, program name, and port
    echo "$pid    $program     $port"
done <<< "$listening_ports"

